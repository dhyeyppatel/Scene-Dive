<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>File Finder</title>
<style>
  :root { --border:#e5e7eb; --muted:#6b7280; --bg:#fff; --text:#111827; }
  *{box-sizing:border-box} body{font-family:system-ui,Arial,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:24px;max-width:980px}
  h1{margin:0 0 12px;font-size:22px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  input{flex:1;min-width:260px;padding:12px 14px;border:1px solid var(--border);border-radius:12px;font-size:16px}
  .count{color:var(--muted);font-size:14px}
  ul{list-style:none;margin:16px 0 60px;padding:0}
  li{border:1px solid var(--border);border-radius:14px;padding:12px 14px;margin:10px 0;display:flex;gap:12px;align-items:center;justify-content:space-between}
  a{color:var(--text);text-decoration:none} a:hover{color:#2563eb}
  .size{color:var(--muted);font-size:12px;margin-top:4px}
  .open{white-space:nowrap;background:#111827;color:#fff;padding:8px 12px;border-radius:10px;font-size:14px;text-decoration:none}
  .footer{position:fixed;left:0;right:0;bottom:0;padding:10px 16px;border-top:1px solid var(--border);background:#fff;color:var(--muted);font-size:12px}
</style>
</head>
<body>
  <h1>File Finder</h1>
  <div class="row">
    <input id="q" placeholder="Search titleâ€¦ (e.g., guest, srt, movie name)" autofocus />
    <div class="count" id="count">Loadingâ€¦</div>
  </div>
  <ul id="list"><li>Type to searchâ€¦</li></ul>
  <div class="footer">Tip: Click a result to open Telegram and receive the file.</div>

<script>
  // ðŸ‘‰ your bot (no @)
  const BOT = "dhyeyautofilterobot";

  // shards live in ./data/*.json with a ./data/manifest.json
  let MANIFEST = { files: [], total: 0 };
  const CACHE = new Map();  // filename -> array of rows
  let ALL = [];             // concatenated rows
  let loadingAll = false;

  const q = document.getElementById('q');
  const ul = document.getElementById('list');
  const count = document.getElementById('count');

  // init
  fetch('data/manifest.json')
    .then(r => r.json())
    .then(m => { MANIFEST = m; count.textContent = `${m.total} items (type to search)`; })
    .catch(() => { count.textContent = 'Could not load manifest.json'; });

  // debounce typing
  let timer;
  q.addEventListener('input', () => { clearTimeout(timer); timer = setTimeout(runSearch, 150); });

  async function runSearch(){
    const term = q.value.trim().toLowerCase();
    if (!term) { count.textContent = `${MANIFEST.total} items`; ul.innerHTML = '<li>Type to searchâ€¦</li>'; return; }

    // first search â†’ start loading all shards progressively
    if (!loadingAll && CACHE.size === 0) {
      loadingAll = true;
      const files = MANIFEST.files.slice();
      let done = 0; const CONC = 8; // parallel fetches
      count.textContent = `Loading shardsâ€¦ (0/${files.length})`;
      const worker = async () => {
        while(files.length){
          const f = files.shift();
          try {
            const rows = await fetch('data/'+f).then(r=>r.json());
            CACHE.set(f, rows); ALL.push(...rows);
          } catch {}
          done++; count.textContent = `Loading shardsâ€¦ (${done}/${MANIFEST.files.length})`;
        }
      };
      await Promise.all(Array.from({length:CONC}, worker));
      loadingAll = false;
    }

    // search the data we have (works even while shards are still downloading)
    const source = ALL.length ? ALL : Array.from(CACHE.values()).flat();
    const res = source.filter(x => x.t && x.t.toLowerCase().includes(term)).slice(0, 400);
    count.textContent = `${res.length} match(es)`;
    render(res);
  }

  function sizeHuman(n){
    if(!n || isNaN(n)) return "â€”";
    const u=["B","KB","MB","GB","TB"]; let i=0; while(n>=1024&&i<u.length-1){n/=1024;i++}
    return n.toFixed(i?1:0)+" "+u[i];
  }

  function render(rows){
    ul.innerHTML = '';
    rows.forEach(x=>{
      const li = document.createElement('li');

      const left = document.createElement('div');
      const a = document.createElement('a');
      a.href = `https://t.me/${BOT}?start=${encodeURIComponent(x.fid)}`;
      a.target = "_blank";
      a.textContent = x.t || "Untitled";

      const sz = document.createElement('div');
      sz.className = 'size';
      sz.textContent = sizeHuman(x.s);

      const open = document.createElement('a');
      open.className = 'open';
      open.href = a.href;
      open.target = "_blank";
      open.textContent = 'Open in Telegram';

      left.appendChild(a);
      left.appendChild(sz);
      li.appendChild(left);
      li.appendChild(open);
      ul.appendChild(li);
    });
  }
</script>
</body>
</html>
